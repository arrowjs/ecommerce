/**
 * Created by thanhnv on 3/9/15.
 */
function showDetail(e,i){var a=$(e).parents("li").first().find(".box").first();if(a.hasClass("open"))if(a.removeClass("open"),a.addClass("close"),void 0==i)$(e).removeClass("fa-caret-down"),$(e).addClass("fa-caret-left");else{var t=$(e).parents("li").first().find("a").first();$(t).removeClass("fa-caret-down"),$(t).addClass("fa-caret-left")}else a.removeClass("close"),a.addClass("open"),void 0==i&&($(e).removeClass("fa-caret-left"),$(e).addClass("fa-caret-down"));return!1}function saveWidget(e){{var i=$(e).parents("form"),a=$(e).parents(".box").first();$(e).parents("li").first()}return showBlock(a),$.ajax({type:"POST",url:"/admin/widgets/sidebars/save",data:i.serialize()}).done(function(e){return i.find('input[name="id"]').val(e),i.find('input[name="ordering"]').remove(),removeBlock(a),!1}),!1}function removeWidget(e){var i=$(e).parents("form").find('input[name="id"]').val(),a=$(e).parents(".box").first();return""!=i?(showBlock(a),$.ajax({url:"/admin/widgets/sidebars/"+i,type:"DELETE"}).done(function(){return $(e).parents("li").first().remove(),removeBlock(a),!1})):$(e).parents("li").first().remove(),!1}function showBlock(e){$(e).append('<div class="overlay"><i class="fa fa-refresh fa-spin"></i></div>')}function removeBlock(e){$(e).find(".overlay").remove()}function sorting(e,i){var a=$(e).parents(".box").first();for(var t in i)""==i[t]&&a.find("form").find("input[name='ordering']").val(parseInt(t)+1);showBlock(a),$.ajax({url:"/admin/widgets/sidebars/sort",type:"POST",data:{ids:i.join(","),sidebar:a.attr("id")}}).done(function(){removeBlock(a)})}$(function(){$("#widgets li").draggable({appendTo:"body",helper:"clone"}),$(".sidebar-widget").droppable({activeClass:"ui-state-default",hoverClass:"widget-state-hover",accept:":not(.ui-sortable-helper)",drop:function(e,i){$(this).find(".placeholder").remove();var a=$("<li style='position: relative' id=''></li>");a.append("<div class='widget-item'></div>"),a.append('<a href="#" class="fa fa-caret-down expand_arrow" onclick="return showDetail(this);"></a>'),_this=$(this),a.find(".widget-item").first().text(i.draggable.text());var t=$(this);$.ajax({url:"/admin/widgets/sidebars/add/"+i.draggable.attr("data-alias")}).done(function(e){var i=$("<div class='box box-solid open'><div class='box-body'></div></div>");i.find(".box-body").first().append(e),i.find("form").first().append("<input type='hidden' name='sidebar' value='"+_this.parents(".box").first().attr("id")+"'>"),i.find("form").first().append("<input type='hidden' name='ordering' value='"+(t.find("li").length+1)+"'>"),a.append(i),t.append(a)})}}).sortable({delay:100,items:"li",placeholder:"placeholder",sort:function(){$(this).removeClass("ui-state-default")},connectWith:".sidebar-widget",receive:function(){$(this).find(".placeholder").remove(),console.log("Receive"),console.log(this);var e=$(this).sortable("toArray");console.log(e),sorting(this,e)},remove:function(){0==$(this).find(".widget-item").length&&0==$(this).find(".placeholder").length&&$(this).find("ul").append("<li class='placeholder'>Drop widget here</li>")},stop:function(){console.log("Stop"),console.log(this);var e=$(this).sortable("toArray");console.log(e),sorting(this,e)}})});
